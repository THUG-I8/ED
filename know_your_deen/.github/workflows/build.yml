name: ğŸ—ï¸ Build APK

on:
  push:
    branches: [ main, master ]
  pull_request:
    branches: [ main, master ]
  workflow_dispatch:

jobs:
  build:
    runs-on: ubuntu-latest
    
                steps:
            - name: ğŸ“¥ Checkout repository
              uses: actions/checkout@v4
              
            - name: â˜• Set up JDK 17
              uses: actions/setup-java@v4
              with:
                java-version: '17'
                distribution: 'temurin'
        
    - name: ğŸ¦ Set up Flutter
      uses: subosito/flutter-action@v2
      with:
        flutter-version: '3.16.9'
        channel: 'stable'
        
    - name: ğŸ“¦ Get dependencies
      run: flutter pub get
      
    - name: ğŸ”§ Build APK
      run: flutter build apk --release --target-platform android-arm64
      
    - name: ğŸ·ï¸ Get version
      id: version
      run: echo "version=$(grep 'version:' pubspec.yaml | cut -d ' ' -f 2 | cut -d '+' -f 1)" >> $GITHUB_OUTPUT
      
                    - name: ğŸ“¤ Upload APK
                  uses: actions/upload-artifact@v4
                  with:
                    name: know-your-deen-v${{ steps.version.outputs.version }}
                    path: build/app/outputs/flutter-apk/app-release.apk
        
    - name: ğŸš€ Create Release
      if: github.event_name == 'push' && (github.ref == 'refs/heads/main' || github.ref == 'refs/heads/master')
      uses: softprops/action-gh-release@v1
      with:
        tag_name: v${{ steps.version.outputs.version }}-${{ github.run_number }}
        name: Ø§Ø¹Ø±Ù Ø¯ÙŠÙ†Ùƒ v${{ steps.version.outputs.version }}
        body: |
          ## ğŸŒŸ ØªØ·Ø¨ÙŠÙ‚ Ø§Ø¹Ø±Ù Ø¯ÙŠÙ†Ùƒ - Ø¥ØµØ¯Ø§Ø± Ø¬Ø¯ÙŠØ¯
          
          ### âœ¨ Ø§Ù„Ù…Ù…ÙŠØ²Ø§Øª:
          - ğŸ“– Ù‚ØµØ© Ø¥Ø³Ù„Ø§Ù…ÙŠØ© ÙŠÙˆÙ…ÙŠØ©
          - ğŸ“¿ Ø³Ø¨Ø­Ø© Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠØ© Ø°ÙƒÙŠØ©  
          - ğŸ• Ù…ÙˆØ§Ù‚ÙŠØª Ø§Ù„ØµÙ„Ø§Ø©
          - ğŸ§­ Ø§ØªØ¬Ø§Ù‡ Ø§Ù„Ù‚Ø¨Ù„Ø©
          - ğŸŒ™ Ø£Ø°ÙƒØ§Ø± Ø§Ù„ØµØ¨Ø§Ø­ ÙˆØ§Ù„Ù…Ø³Ø§Ø¡
          - ğŸ¨ ØªØµÙ…ÙŠÙ… Ø¥Ø³Ù„Ø§Ù…ÙŠ Ø¬Ù…ÙŠÙ„
          
          ### ğŸ“± Ø§Ù„ØªØ­Ù…ÙŠÙ„:
          Ø­Ù…Ù„ Ø§Ù„Ù…Ù„Ù `app-release.apk` ÙˆØ«Ø¨ØªÙ‡ Ø¹Ù„Ù‰ Ø¬Ù‡Ø§Ø²Ùƒ
          
          ### ğŸ”’ Ù…Ù„Ø§Ø­Ø¸Ø© Ø§Ù„Ø£Ù…Ø§Ù†:
          Ù‚Ø¯ ØªØ­ØªØ§Ø¬ Ù„ØªÙØ¹ÙŠÙ„ "ØªØ«Ø¨ÙŠØª Ù…Ù† Ù…ØµØ§Ø¯Ø± ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙØ©" ÙÙŠ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª
          
          ---
          **Ø¨Ø§Ø±Ùƒ Ø§Ù„Ù„Ù‡ ÙÙŠÙƒÙ… ÙˆÙ†ÙØ¹ Ø¨Ù‡Ø°Ø§ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ ğŸ¤²**
        files: build/app/outputs/flutter-apk/app-release.apk
        draft: false
        prerelease: false
      env:
        GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}